<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/study-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/study-16x16.png">
  <link rel="mask-icon" href="/images/study.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="NoSQL 用户访问量激增，会给服务器和数据库的压力很大：  服务器：CPU和内存压力   负载均衡可以通过Nginx实现 方案四效果最好，通过NoSQL实现   数据库：IO压力   将访问频繁的数据添加到缓存数据库中，减少IO压力     NoSQL（Not only SQL）数据库：非关系型数据库  不依赖业务逻辑，以简单的key-value形式存储 不支持ACID 性能远超SQL   适用">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis6">
<meta property="og:url" content="http://example.com/2021/12/19/day28/index.html">
<meta property="og:site_name" content="Magic">
<meta property="og:description" content="NoSQL 用户访问量激增，会给服务器和数据库的压力很大：  服务器：CPU和内存压力   负载均衡可以通过Nginx实现 方案四效果最好，通过NoSQL实现   数据库：IO压力   将访问频繁的数据添加到缓存数据库中，减少IO压力     NoSQL（Not only SQL）数据库：非关系型数据库  不依赖业务逻辑，以简单的key-value形式存储 不支持ACID 性能远超SQL   适用">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_1.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_2.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_3.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_4.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_5.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_6.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_7.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_8.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_9.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_10.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_11.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_12.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_13.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_14.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_15.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_16.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_17.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_19.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_18.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_20.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_21.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_22.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_23.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_24.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_25.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_26.png">
<meta property="og:image" content="http://example.com/2021/12/19/day28/day28_27.png">
<meta property="article:published_time" content="2021-12-19T04:55:31.111Z">
<meta property="article:modified_time" content="2022-09-01T15:30:46.022Z">
<meta property="article:author" content="Kaixuan Wang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2021/12/19/day28/day28_1.png">

<link rel="canonical" href="http://example.com/2021/12/19/day28/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Redis6 | Magic</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Magic</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/19/day28/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Kaixuan Wang">
      <meta itemprop="description" content="只争朝夕">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Magic">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Redis6
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-19 12:55:31" itemprop="dateCreated datePublished" datetime="2021-12-19T12:55:31+08:00">2021-12-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-09-01 23:30:46" itemprop="dateModified" datetime="2022-09-01T23:30:46+08:00">2022-09-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="NoSQL"><a href="#NoSQL" class="headerlink" title="NoSQL"></a>NoSQL</h1><ul>
<li><p>用户访问量激增，会给服务器和数据库的压力很大：</p>
<ul>
<li><p>服务器：CPU和内存压力</p>
<p><img src="/2021/12/19/day28/day28_1.png" alt="解决方案"></p>
<ul>
<li>负载均衡可以通过Nginx实现</li>
<li>方案四效果最好，通过NoSQL实现</li>
</ul>
</li>
<li><p>数据库：IO压力</p>
<p><img src="/2021/12/19/day28/day28_2.png" alt="解决方案"></p>
<ul>
<li>将访问频繁的数据添加到缓存数据库中，减少IO压力</li>
</ul>
</li>
</ul>
</li>
<li><p>NoSQL（Not only SQL）数据库：非关系型数据库</p>
<ul>
<li>不依赖业务逻辑，以简单的key-value形式存储</li>
<li>不支持ACID</li>
<li>性能远超SQL</li>
</ul>
</li>
<li><p>适用场景：</p>
<ul>
<li>对数据高并发的读写</li>
<li>海量数据读写</li>
<li>数据可扩展性高</li>
</ul>
</li>
<li><p>行式存储数据库：</p>
<ul>
<li><p>行式数据库</p>
<p><img src="/2021/12/19/day28/day28_3.png" alt="行式数据库"></p>
</li>
<li><p>列式数据库</p>
<p><img src="/2021/12/19/day28/day28_4.png" alt="列式数据库"></p>
</li>
</ul>
</li>
<li><p>图关系型数据库：社会关系、公共交通网络、地图饥网络拓扑</p>
<p><img src="/2021/12/19/day28/day28_5.png" alt="图关系型数据库"></p>
</li>
</ul>
<h1 id="Redis概述"><a href="#Redis概述" class="headerlink" title="Redis概述"></a>Redis概述</h1><ul>
<li><p>特点：</p>
<ul>
<li><p> Redis是一个开源的key-value存储系统</p>
</li>
<li><p>支持存储的value类型相对更多，包括string(字符串)、list(链表)、set(集合)、zset(sorted set –有序集合)和hash（哈希类型）</p>
</li>
<li><p>这些数据类型都支持push/pop、add/remove及取交集并集和差集及更丰富的操作，而且这些操作都是原子性的</p>
</li>
<li><p>Redis支持各种不同方式的排序。</p>
</li>
<li><p>为了保证效率，数据都是缓存在内存中。</p>
</li>
<li><p>Redis会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件。</p>
</li>
<li><p>实现了master-slave(主从)同步</p>
</li>
</ul>
</li>
<li><p>Redis：单线程+多路I/O复用</p>
<p>  <img src="/2021/12/19/day28/day28_6.png" alt="举例"></p>
<ul>
<li>Redis扮演黄牛角色，当有多个数据请求时，Redis接受所有请求，并单线程处理每个请求，此时每个客户端可以做自己的事情，不会出现阻塞。Redis每处理一个请求，就给相应的客户端响应</li>
</ul>
<blockquote>
<p>Redis与memcached区别：</p>
<ul>
<li>Redis支持多数据类型</li>
<li>Redis支持持久化</li>
<li>Redis是单线程+多路复用，memcached是多线程+锁</li>
</ul>
</blockquote>
</li>
</ul>
<h1 id="常用数据结构"><a href="#常用数据结构" class="headerlink" title="常用数据结构"></a>常用数据结构</h1><h2 id="Key操作"><a href="#Key操作" class="headerlink" title="Key操作"></a>Key操作</h2><ul>
<li><p>keys * ：查看当前库所有key   (匹配：keys *1)</p>
</li>
<li><p>exists key：判断某个key是否存在</p>
</li>
<li><p>type key ：查看你的key是什么类型</p>
</li>
<li><p>del key   ：删除指定的key数据</p>
</li>
<li><p>unlink key ：根据value选择非阻塞删除</p>
<p>​    仅将keys从keyspace元数据中删除，真正的删除会在后续异步操作。</p>
</li>
<li><p>expire key 10  10秒钟：为给定的key设置过期时间</p>
</li>
<li><p>ttl key 查看还有多少秒过期，-1表示永不过期，-2表示已过期</p>
</li>
<li><p>select命令切换数据库</p>
</li>
<li><p>dbsize查看当前数据库的key的数量</p>
</li>
<li><p>flushdb清空当前库</p>
</li>
<li><p>flushall通杀全部库</p>
</li>
</ul>
<h2 id="String"><a href="#String" class="headerlink" title="String"></a>String</h2><ul>
<li><p>二进制安全：意味着Redis的string可以包含任何数据。例如图片或者序列化的对象，都可以再通过解码变为原来的属性。</p>
</li>
<li><p>一个字符串value最多可以是512M</p>
</li>
<li><p>set  &lt;key&gt;&lt;value&gt;添加键值对</p>
<ul>
<li>NX：当数据库中key不存在时，可以将key-value添加数据库</li>
<li>XX：当数据库中key存在时，可以将key-value添加数据库，与NX参数互斥</li>
<li>EX：key的超时秒数</li>
<li>PX：key的超时毫秒数，与EX互斥</li>
</ul>
</li>
<li><p>get  &lt;key&gt;查询对应键值</p>
</li>
<li><p>append  &lt;key&gt;&lt;value&gt;将给定的&lt;value&gt; 追加到原值的末尾</p>
</li>
<li><p>strlen  &lt;key&gt;获得值的长度</p>
</li>
<li><p>setnx  &lt;key&gt;&lt;value&gt;只有在 key 不存在时   设置 key 的值</p>
</li>
<li><p>incr  &lt;key&gt;：将 key 中储存的数字值增1；只能对数字值操作，如果为空，新增值为1</p>
</li>
<li><p>decr  &lt;key&gt;：将 key 中储存的数字值减1</p>
</li>
<li><p>incrby / decrby  &lt;key&gt;&lt;步长&gt;：将 key 中储存的数字值增减。自定义步长。</p>
</li>
<li><p>mset  &lt;key1&gt;&lt;value1&gt;&lt;key2&gt;&lt;value2&gt;  ….. ：同时设置一个或多个 key-value对  </p>
</li>
<li><p>mget  &lt;key1&gt;&lt;key2&gt;&lt;key3&gt; …..：同时获取一个或多个 value  </p>
</li>
<li><p>msetnx &lt;key1&gt;&lt;value1&gt;&lt;key2&gt;&lt;value2&gt;  ….. ：同时设置一个或多个 key-value 对，当且仅当所有给定 key 都不存在</p>
</li>
</ul>
<blockquote>
<p>Redis单命令的原子性，主要是因为Redis的单线程，有一个失败就全部失败</p>
</blockquote>
<ul>
<li>getrange  &lt;key&gt;&lt;起始位置&gt;&lt;结束位置&gt;：获得值的范围，类似java中的substring</li>
<li>setrange  &lt;key&gt;&lt;起始位置&gt;&lt;value&gt;：用 &lt;value&gt;  覆写&lt;key&gt;所储存的字符串值，从&lt;起始位置&gt;开始(索引从0开始)。</li>
<li>setex  &lt;key&gt;&lt;过期时间&gt;&lt;value&gt;：设置键值的同时，设置过期时间，单位秒。</li>
<li>getset &lt;key&gt;&lt;value&gt;：以新换旧，设置了新值同时获得旧值。</li>
</ul>
<h3 id="String-的数据结构"><a href="#String-的数据结构" class="headerlink" title="String 的数据结构"></a>String 的数据结构</h3><ul>
<li><p>String的数据结构为简单动态字符串(Simple Dynamic String,缩写SDS)。内部结构实现上类似于Java的ArrayList，采用预分配冗余空间的方式来减少内存的频繁分配</p>
<p><img src="/2021/12/19/day28/day28_7.png" alt="String数据结构"></p>
</li>
<li><p>当字符串长度小于1M时，扩容都是加倍现有的空间，如果超过1M，扩容时一次只会多扩1M的空间。字符串最大长度为512M。</p>
</li>
</ul>
<h2 id="List"><a href="#List" class="headerlink" title="List"></a>List</h2><ul>
<li>单键多值：Redis列表可以按照插入的顺序插入到头部或尾部，底层实际上是一个双向链表</li>
<li>lpush/rpush  &lt;key&gt;&lt;value1&gt;&lt;value2&gt;&lt;value3&gt; ：从左边/右边插入一个或多个值</li>
<li>lpop/rpop  &lt;key&gt;：从左边/右边吐出一个值。值在键在，值光键亡。</li>
<li>rpoplpush  &lt;key1&gt;&lt;key2&gt;：从&lt;key1&gt;列表右边吐出一个值，插到&lt;key2&gt;列表左边。</li>
<li>lrange &lt;key&gt;&lt;start&gt;&lt;stop&gt;：按照索引下标获得元素(从左到右)<ul>
<li>-1代表右边第一个</li>
</ul>
</li>
<li>lindex &lt;key&gt;&lt;index&gt;：按照索引下标获得元素(从左到右)</li>
<li>llen &lt;key&gt;：获得列表长度 </li>
<li>linsert &lt;key&gt;  before &lt;value&gt;&lt;newvalue&gt;：在&lt;value&gt;的前面插入&lt;newvalue&gt;</li>
<li>lrem &lt;key&gt;&lt;n&gt;&lt;value&gt;：从左边删除n个value(从左到右)</li>
<li>lset&lt;key&gt;&lt;index&gt;&lt;value&gt;：将列表key下标为index的值替换成value</li>
</ul>
<h3 id="List数据结构"><a href="#List数据结构" class="headerlink" title="List数据结构"></a>List数据结构</h3><ul>
<li>List的数据结构采用快速链表quickList</li>
<li>在列表元素较少的情况下会使用一块连续的内存存储，这个结构是ziplist，也即是压缩列表<ul>
<li>ziplist将所有的元素紧挨着一起存储，分配的是一块连续的内存</li>
</ul>
</li>
<li>当数据量比较多的时候才会改成quickList<ul>
<li>quickList将链表和ziplist进行结合，构成了快速链表，减少了空间冗余</li>
</ul>
</li>
</ul>
<p><img src="/2021/12/19/day28/day28_8.png" alt="quickList"></p>
<h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><ul>
<li>和list功能类似，但是可以自动排重。是一个string类型的无序集合</li>
<li>底层是一个value为null的hash表</li>
<li>sadd &lt;key&gt;&lt;value1&gt;&lt;value2&gt; ….. ：将一个或多个 member 元素加入到集合 key 中，已经存在的 member 元素将被忽略</li>
<li>smembers &lt;key&gt;：取出该集合的所有值。</li>
<li>sismember &lt;key&gt;&lt;value&gt;：判断集合&lt;key&gt;是否为含有该&lt;value&gt;值，有1，没有0</li>
<li>scard&lt;key&gt;：返回该集合的元素个数</li>
<li>srem &lt;key&gt;&lt;value1&gt;&lt;value2&gt; ….： 删除集合中的某个元素</li>
<li>spop &lt;key&gt;：随机从该集合中吐出一个值。</li>
<li>srandmember &lt;key&gt;&lt;n&gt;：随机从该集合中取出n个值。不会从集合中删除 。</li>
<li>smove &lt;source&gt;&lt;destination&gt;&lt;value&gt;：把集合中一个值从一个集合移动到另一个集合</li>
<li>sinter &lt;key1&gt;&lt;key2&gt;：返回两个集合的交集元素。</li>
<li>sunion &lt;key1&gt;&lt;key2&gt;：返回两个集合的并集元素。</li>
<li>sdiff &lt;key1&gt;&lt;key2&gt;：返回两个集合的差集元素(key1中有的，key2中没有的)</li>
</ul>
<h3 id="set的数据结构"><a href="#set的数据结构" class="headerlink" title="set的数据结构"></a>set的数据结构</h3><ul>
<li>set的数据结构是dict字典，字典是用哈希表实现的</li>
</ul>
<h2 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h2><ul>
<li>键值对集合，string 类型的field和value的映射表，适合存储对象</li>
</ul>
<p><img src="/2021/12/19/day28/day28_9.png" alt="存储方式"></p>
<ul>
<li>hset &lt;key&gt;&lt;field&gt;&lt;value&gt;：给&lt;key&gt;集合中的  &lt;field&gt;键赋值&lt;value&gt;</li>
<li>hget &lt;key1&gt;&lt;field&gt;从&lt;key1&gt;集合&lt;field&gt;取出 value </li>
<li>hmset &lt;key1&gt;&lt;field1&gt;&lt;value1&gt;&lt;field2&gt;&lt;value2&gt;… ：批量设置value</li>
<li>hexists&lt;key1&gt;&lt;field&gt;：查看哈希表 key 中，给定域 field 是否存在。 </li>
<li>hkeys &lt;key&gt;：列出该hash集合的所有field</li>
<li>hvals &lt;key&gt;：列出该hash集合的所有value</li>
<li>hincrby &lt;key&gt;&lt;field&gt;&lt;increment&gt;：为哈希表 key 中的域 field 的值加上增量</li>
<li>hsetnx &lt;key&gt;&lt;field&gt;&lt;value&gt;：将哈希表 key 中的域 field 的值设置为 value ，当且仅当域 field 不存在 .</li>
</ul>
<h3 id="Hash数据结构"><a href="#Hash数据结构" class="headerlink" title="Hash数据结构"></a>Hash数据结构</h3><ul>
<li>Hash类型对应的数据结构是两种：ziplist（压缩列表），hashtable（哈希表）<ul>
<li>当field-value长度较短且个数较少时，使用ziplist，否则使用hashtable</li>
</ul>
</li>
</ul>
<h2 id="Zset-sorted-set"><a href="#Zset-sorted-set" class="headerlink" title="Zset(sorted set)"></a>Zset(sorted set)</h2><ul>
<li>Zset每个成员都关联了一个评分（score），这个评分（score）被用来按照从最低分到最高分的方式排序集合中的成员。集合的成员是唯一的，但是评分可以重复。类似优先队列</li>
<li>zadd  &lt;key&gt;&lt;score1&gt;&lt;value1&gt;&lt;score2&gt;&lt;value2&gt;…：将一个或多个 member 元素及其 score 值加入到有序集 key 当中。</li>
<li>zrange &lt;key&gt;&lt;start&gt;&lt;stop&gt;  [WITHSCORES]：返回有序集 key 中，下标在&lt;start&gt;&lt;stop&gt;之间的元素。带WITHSCORES，可以让分数一起和值返回到结果集。</li>
<li>zrangebyscore key minmax [withscores] [limit offset count]：返回有序集 key 中，所有 score 值介于 min 和 max 之间(包括等于 min 或 max )的成员。有序集成员按 score 值递增(从小到大)次序排列。 </li>
<li>zrevrangebyscore key maxmin [withscores] [limit offset count]：同上，改为从大到小排列。 </li>
<li>zincrby &lt;key&gt;&lt;increment&gt;&lt;value&gt;：为元素的score加上增量</li>
<li>zrem  &lt;key&gt;&lt;value&gt;：删除该集合下，指定值的元素 </li>
<li>zcount &lt;key&gt;&lt;min&gt;&lt;max&gt;：统计该集合，分数区间内的元素个数 </li>
<li>zrank &lt;key&gt;&lt;value&gt;：返回该值在集合中的排名，从0开始</li>
</ul>
<h3 id="Zset数据结构"><a href="#Zset数据结构" class="headerlink" title="Zset数据结构"></a>Zset数据结构</h3><ul>
<li>zset底层使用了两个数据结构:<ul>
<li>hash，hash的作用就是关联元素value和权重score，保障元素value的唯一性，可以通过元素value找到相应的score值</li>
<li>跳跃表，跳跃表的目的在于给元素value排序，根据score的范围获取元素列表。</li>
</ul>
</li>
</ul>
<h1 id="发布与订阅"><a href="#发布与订阅" class="headerlink" title="发布与订阅"></a>发布与订阅</h1><ul>
<li><p>发布订阅是一种通信方式：发布者发送消息，订阅者接收消息</p>
</li>
<li><p>发布者通过频道发布消息，订阅者通过频道接收消息。Redis中，客户端可以订阅任意数量的频道</p>
<p><img src="/2021/12/19/day28/day28_10.png" alt="订阅"></p>
</li>
</ul>
<p><img src="/2021/12/19/day28/day28_11.png" alt="发布"></p>
<ul>
<li>发布的信息没有持久化，订阅的客户端只能收到订阅之后发布的消息</li>
</ul>
<h1 id="新的数据类型"><a href="#新的数据类型" class="headerlink" title="新的数据类型"></a>新的数据类型</h1><h2 id="Bitmaps"><a href="#Bitmaps" class="headerlink" title="Bitmaps"></a>Bitmaps</h2><ul>
<li><p>Bitmaps本身不是一种数据类型，实际上是字符串，但可以对字符串进行位操作</p>
<p><img src="/2021/12/19/day28/day28_12.png" alt="Bitmaps"></p>
</li>
<li><p>setbit&lt;key&gt;&lt;offset&gt;&lt;value&gt;：设置Bitmaps中某个偏移量的值（0或1）</p>
<ul>
<li>偏移量从0开始</li>
<li>第一次初始化时，如果偏移量较大，初始化过程会比较慢，造成Redis阻塞</li>
</ul>
</li>
<li><p>getbit&lt;key&gt;&lt;offset&gt;：获取Bitmaps中某个偏移量的值</p>
</li>
<li><p>bitcount&lt;key&gt;[start end] ：统计字符串从start字节到end字节比特值为1的数量</p>
</li>
<li><p>bitop and(or/not/xor) &lt;destkey&gt; [key…]：复合操作， 它可以做多个Bitmaps的and（交集） 、 or（并集） 、 not（非） 、 xor（异或） 操作并将结果保存在destkey中</p>
</li>
</ul>
<h2 id="HyperLogLog"><a href="#HyperLogLog" class="headerlink" title="HyperLogLog"></a>HyperLogLog</h2><ul>
<li><p>基数问题：求解集合中不重复元素个数</p>
</li>
<li><p>基数问题的解决：</p>
<ul>
<li>MySQL：使用distinct count</li>
<li>Redis：提供hash、set、bitmaps等数据结构</li>
</ul>
<blockquote>
<p>问题：数据量比较大时，占用空间越来越大</p>
</blockquote>
</li>
<li><p>HyperLogLog解决基数问题，牺牲一定的精度，占用少量空间</p>
<ul>
<li>计算基数问题的空间固定，每个HyperLogLog占用12KB内存，可以计算2^64个不同元素的基数</li>
<li>只能根据输入来计算基数</li>
</ul>
</li>
<li><p>pfadd &lt;key&gt;&lt; element&gt; [element …]：  添加指定元素到 HyperLogLog 中</p>
</li>
<li><p>pfcount&lt;key&gt; [key …]：计算HLL的近似基数，可以计算多个</p>
</li>
<li><p>pfmerge&lt;destkey&gt;&lt;sourcekey&gt; [sourcekey …]：  将一个或多个HLL合并后的结果存储在另一个HLL中</p>
</li>
</ul>
<h2 id="Geospatial"><a href="#Geospatial" class="headerlink" title="Geospatial"></a>Geospatial</h2><ul>
<li>经纬度、地理位置的相关操作</li>
<li>geoadd&lt;key&gt;&lt; longitude&gt;&lt;latitude&gt;&lt;member&gt; [longitude latitude member…] ：添加地理位置（经度，纬度，名称）<ul>
<li>两级无法添加</li>
<li>有效的经度从 -180 度到 180 度。有效的纬度从 -85.05112878 度到 85.05112878 度</li>
</ul>
</li>
<li>geopos  &lt;key&gt;&lt;member&gt; [member…] ： 获得指定地区的坐标值</li>
<li>geodist&lt;key&gt;&lt;member1&gt;&lt;member2&gt;  [m|km|ft|mi ] ：获取两个位置之间的直线距离，默认米为单位</li>
<li>georadius&lt;key&gt;&lt; longitude&gt;&lt;latitude&gt;&lt;radius&gt; m|km|ft|mi ：以给定的经纬度为中心，找出某一半径内的元素</li>
</ul>
<h1 id="Jedis"><a href="#Jedis" class="headerlink" title="Jedis"></a>Jedis</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//连接redis</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;192.168.254.131&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        jedis.auth(<span class="string">&quot;******&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//测试</span></span><br><span class="line">        String value = jedis.ping();</span><br><span class="line">        System.out.println(value); <span class="comment">//PONG</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//操作key String</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//连接redis</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;192.168.254.131&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        jedis.auth(<span class="string">&quot;******&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//添加</span></span><br><span class="line">        jedis.set(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;lucy&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取</span></span><br><span class="line">        String name = jedis.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(name);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//批量操作</span></span><br><span class="line">        jedis.mset(<span class="string">&quot;key1&quot;</span>,<span class="string">&quot;v1&quot;</span>,<span class="string">&quot;key2&quot;</span>,<span class="string">&quot;v2&quot;</span>);</span><br><span class="line">        List&lt;String&gt; mget = jedis.mget(<span class="string">&quot;key1&quot;</span>, <span class="string">&quot;key2&quot;</span>);</span><br><span class="line">        System.out.println(mget);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//获得所有的key</span></span><br><span class="line">        Set&lt;String&gt; keys = jedis.keys(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(String s:keys)&#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//操做list</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//连接redis</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;192.168.254.131&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        jedis.auth(<span class="string">&quot;******&quot;</span>);</span><br><span class="line"></span><br><span class="line">        jedis.flushDB();</span><br><span class="line">        jedis.lpush(<span class="string">&quot;key1&quot;</span>,<span class="string">&quot;v1&quot;</span>,<span class="string">&quot;v2&quot;</span>,<span class="string">&quot;v3&quot;</span>);</span><br><span class="line">        jedis.lset(<span class="string">&quot;key1&quot;</span>, <span class="number">0</span>, <span class="string">&quot;v4&quot;</span>);</span><br><span class="line">        List&lt;String&gt; lrange = jedis.lrange(<span class="string">&quot;key1&quot;</span>, <span class="number">0</span>, jedis.llen(<span class="string">&quot;key1&quot;</span>) - <span class="number">1</span>);</span><br><span class="line">        System.out.println(lrange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//操做set</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo3</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//连接redis</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;192.168.254.131&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        jedis.auth(<span class="string">&quot;******&quot;</span>);</span><br><span class="line"></span><br><span class="line">        jedis.flushDB();</span><br><span class="line">        jedis.sadd(<span class="string">&quot;key1&quot;</span>, <span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="string">&quot;d&quot;</span>,<span class="string">&quot;e&quot;</span>,<span class="string">&quot;a&quot;</span>);</span><br><span class="line">        Set&lt;String&gt; key1 = jedis.smembers(<span class="string">&quot;key1&quot;</span>);</span><br><span class="line">        System.out.println(key1);</span><br><span class="line">        System.out.println(jedis.srandmember(<span class="string">&quot;key1&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//操做hash</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo4</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//连接redis</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;192.168.254.131&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        jedis.auth(<span class="string">&quot;******&quot;</span>);</span><br><span class="line"></span><br><span class="line">        jedis.flushDB();</span><br><span class="line">        jedis.hset(<span class="string">&quot;map1&quot;</span>,<span class="string">&quot;field1&quot;</span>,<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        String hget = jedis.hget(<span class="string">&quot;map1&quot;</span>, <span class="string">&quot;field1&quot;</span>);</span><br><span class="line">        System.out.println(hget);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//操做zset</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo5</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//连接redis</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;192.168.254.131&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        jedis.auth(<span class="string">&quot;******&quot;</span>);</span><br><span class="line"></span><br><span class="line">        jedis.flushDB();</span><br><span class="line">        jedis.zadd(<span class="string">&quot;zset01&quot;</span>, <span class="number">100d</span>, <span class="string">&quot;z3&quot;</span>);</span><br><span class="line">        jedis.zadd(<span class="string">&quot;zset01&quot;</span>, <span class="number">90d</span>, <span class="string">&quot;l4&quot;</span>);</span><br><span class="line">        jedis.zadd(<span class="string">&quot;zset01&quot;</span>, <span class="number">80d</span>, <span class="string">&quot;w5&quot;</span>);</span><br><span class="line">        jedis.zadd(<span class="string">&quot;zset01&quot;</span>, <span class="number">70d</span>, <span class="string">&quot;z6&quot;</span>);</span><br><span class="line">        Set&lt;String&gt; zset01 = jedis.zrange(<span class="string">&quot;zset01&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        System.out.println(zset01);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="模拟验证码发送"><a href="#模拟验证码发送" class="headerlink" title="模拟验证码发送"></a>模拟验证码发送</h2><blockquote>
<ol>
<li>发送6位数字码，2分钟有效</li>
<li>验证</li>
<li>每个手机号每天只能输入三次</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisDemo2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(getRandomCode());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//6位验证码</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getRandomCode</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">int</span> rand = <span class="number">100000</span> + random.nextInt(<span class="number">899999</span>);</span><br><span class="line">        <span class="keyword">return</span> String.valueOf(rand);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//验证码放入</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">putCode</span><span class="params">(String phoneNumber)</span></span>&#123;</span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;192.168.254.131&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        jedis.auth(<span class="string">&quot;wan.1314&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//拼接key</span></span><br><span class="line">        String codeKey = <span class="string">&quot;VerifyCode &quot;</span>+phoneNumber+<span class="string">&quot; code:&quot;</span>;</span><br><span class="line">        String countKey = <span class="string">&quot;VerifyCode &quot;</span>+phoneNumber+<span class="string">&quot; count:&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//三次限制</span></span><br><span class="line">        String count = jedis.get(countKey);</span><br><span class="line">        <span class="keyword">if</span> (count == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//一次都没有</span></span><br><span class="line">            jedis.setex(countKey, <span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (Integer.parseInt(count) &lt;= <span class="number">2</span>)&#123;</span><br><span class="line">            jedis.incr(countKey);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;无法多次发送！&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//存放验证码</span></span><br><span class="line">        jedis.setex(codeKey, <span class="number">2</span>*<span class="number">60</span>, getRandomCode());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//校验</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">verifyCode</span><span class="params">(String phoneNumber,String code)</span></span>&#123;</span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;192.168.254.131&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        jedis.auth(<span class="string">&quot;wan.1314&quot;</span>);</span><br><span class="line">        String codeKey = <span class="string">&quot;VerifyCode &quot;</span>+phoneNumber+<span class="string">&quot; code:&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> code.equals(jedis.get(codeKey));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="SpringBoot整合Redis"><a href="#SpringBoot整合Redis" class="headerlink" title="SpringBoot整合Redis"></a>SpringBoot整合Redis</h1><ul>
<li><p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>配置参数</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.254</span><span class="number">.131</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="comment">#链接超时（毫秒）</span></span><br><span class="line">    <span class="attr">connect-timeout:</span> <span class="number">1800000</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="comment">#最大连接数</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">20</span></span><br><span class="line">        <span class="comment">#最大阻塞时间（-1表示没有限制）</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="number">-1</span></span><br><span class="line">        <span class="comment">#最大空闲链接</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">5</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><ul>
<li><p>Redis事务：事务中的所有命令都会序列化、按顺序地执行。不会被其他客户端发送来的命令请求所打断。</p>
<ul>
<li>串联多个命令，不允许别的命令插队</li>
</ul>
</li>
<li><p>事务操作：</p>
<ul>
<li><strong>Multi</strong>：开启事务，进入组队阶段<ul>
<li>组队阶段报错，提交会失败</li>
<li>组队成功，提交也有可能失败</li>
</ul>
</li>
<li><strong>Exec</strong>：执行事务</li>
<li><strong>discard</strong>：放弃事务</li>
</ul>
<p><img src="/2021/12/19/day28/day28_13.png" alt="Redis事务"></p>
<ul>
<li><strong>组队阶段报错，执行时整个队列都会被取消；执行阶段报错，只有报错的命令不会被执行，其他的都会执行，不会回滚</strong></li>
</ul>
</li>
</ul>
<h2 id="悲观锁和乐观锁"><a href="#悲观锁和乐观锁" class="headerlink" title="悲观锁和乐观锁"></a>悲观锁和乐观锁</h2><ul>
<li><p>事务冲突</p>
<p><img src="/2021/12/19/day28/day28_14.png" alt="事务冲突"></p>
</li>
<li><p>悲观锁：每次对数据进行操作，在获得数据后，会给数据加锁，不允许其他程序操作。传统的关系型数据库里边就用到了很多这种锁机制，比如行锁，表锁、读锁、写锁等，都是在做操作之前先上锁</p>
<ul>
<li>效率低</li>
</ul>
<p><img src="/2021/12/19/day28/day28_15.png" alt="悲观锁"></p>
</li>
<li><p>乐观锁：每次对数据操作不加锁，在更新的时候会判断在此期间该数据有没有被更改，可以采用<strong>版本号</strong>等机制。</p>
<ul>
<li>效率高，适用于多读的情形，提高吞吐量。Redis就是采用<strong>check-and-set</strong>的机制</li>
</ul>
<p><img src="/2021/12/19/day28/day28_16.png" alt="乐观锁"></p>
</li>
<li><p>**WATCH key / [key…]**：执行muti之前，先执行WATCH，监视一个或多个key，事务执行阶段如果被监视的key被其他操作改动，事务将被打断</p>
<ul>
<li><strong>UNWATCH</strong>：取消所有key的监视</li>
</ul>
</li>
</ul>
<h2 id="Redis事务三大特性"><a href="#Redis事务三大特性" class="headerlink" title="Redis事务三大特性"></a>Redis事务三大特性</h2><ul>
<li>单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，<strong>不会被其他客户端发送来的命令请求所打断</strong></li>
<li>没有隔离级别概念</li>
<li>不保证原子性</li>
</ul>
<h2 id="简单秒杀案例"><a href="#简单秒杀案例" class="headerlink" title="简单秒杀案例"></a>简单秒杀案例</h2><ul>
<li><p>未加入并发</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//秒杀过程</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">doSecKill</span><span class="params">(String uid,String prodid)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">	<span class="comment">//uid和 prodid 非空判断</span></span><br><span class="line">	<span class="keyword">if</span> (uid==<span class="keyword">null</span> || prodid==<span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  </span><br><span class="line">	<span class="comment">//连接redis</span></span><br><span class="line">	Jedis jedis =<span class="keyword">new</span> Jedis(<span class="string">&quot;192.168.44.168&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">	jedis.auth(<span class="string">&quot;wan.1314&quot;</span>);</span><br><span class="line">  </span><br><span class="line">	<span class="comment">//拼接key</span></span><br><span class="line">	String kcKey = <span class="string">&quot;sk:&quot;</span> + prodid + <span class="string">&quot;:qt&quot;</span>;</span><br><span class="line">	String userKey = <span class="string">&quot;sk:&quot;</span> + prodid + <span class="string">&quot;:user&quot;</span>;</span><br><span class="line">  </span><br><span class="line">	String kc = jedis.get(kcKey);</span><br><span class="line">	<span class="keyword">if</span> (kc == <span class="keyword">null</span>)&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;秒杀还未开始，请等待！&quot;</span>);</span><br><span class="line">		jedis.close();</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">	<span class="comment">//判断是否重复秒杀</span></span><br><span class="line">	<span class="keyword">if</span> (jedis.sismember(userKey, uid))&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;已经参加过秒杀，不能重复秒杀&quot;</span>);</span><br><span class="line">		jedis.close();</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">	<span class="comment">//判断库存</span></span><br><span class="line">	<span class="keyword">if</span> (Integer.parseInt(kc) &lt; <span class="number">1</span>)&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;秒杀结束&quot;</span>);</span><br><span class="line">		jedis.close();</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">	<span class="comment">//秒杀过程</span></span><br><span class="line">	jedis.decr(kcKey);</span><br><span class="line">	jedis.sadd(userKey, uid);</span><br><span class="line">	System.out.println(<span class="string">&quot;秒杀成功!&quot;</span>);</span><br><span class="line">	jedis.close();</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>并发场景问题：</p>
<ul>
<li>连接超时问题：redis无法同时处理很多个请求</li>
<li>超卖问题</li>
</ul>
</li>
<li><p><strong>连接超时问题</strong>：使用连接池解决</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisPoolUtil</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> JedisPool jedisPool = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">JedisPoolUtil</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> JedisPool <span class="title">getJedisPoolInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">null</span> == jedisPool) &#123;</span><br><span class="line">			<span class="keyword">synchronized</span> (JedisPoolUtil.class) &#123;</span><br><span class="line">				<span class="keyword">if</span> (<span class="keyword">null</span> == jedisPool) &#123;</span><br><span class="line">					JedisPoolConfig poolConfig = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">					poolConfig.setMaxTotal(<span class="number">200</span>);</span><br><span class="line">					poolConfig.setMaxIdle(<span class="number">32</span>);</span><br><span class="line">					poolConfig.setMaxWaitMillis(<span class="number">100</span>*<span class="number">1000</span>);</span><br><span class="line">					poolConfig.setBlockWhenExhausted(<span class="keyword">true</span>);</span><br><span class="line">					poolConfig.setTestOnBorrow(<span class="keyword">true</span>);  <span class="comment">// ping  PONG</span></span><br><span class="line">				 </span><br><span class="line">					jedisPool = <span class="keyword">new</span> JedisPool(poolConfig, <span class="string">&quot;192.168.44.168&quot;</span>, <span class="number">6379</span>, <span class="number">60000</span> );</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> jedisPool;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">(JedisPool jedisPool, Jedis jedis)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">null</span> != jedis) &#123;</span><br><span class="line">			jedisPool.returnResource(jedis);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>超卖问题</strong>：乐观锁</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//秒杀过程</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">doSecKill</span><span class="params">(String uid,String prodid)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">	<span class="comment">//uid和 prodid 非空判断</span></span><br><span class="line">	<span class="keyword">if</span> (uid==<span class="keyword">null</span> || prodid==<span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  </span><br><span class="line">	<span class="comment">//连接redis</span></span><br><span class="line">	JedisPool jedispool =  JedisPoolUtil.getJedisPoolInstance();</span><br><span class="line">	Jedis jedis=jedispool.getResource();</span><br><span class="line">  </span><br><span class="line">	<span class="comment">//拼接key</span></span><br><span class="line">	String kcKey = <span class="string">&quot;sk:&quot;</span> + prodid + <span class="string">&quot;:qt&quot;</span>;</span><br><span class="line">	String userKey = <span class="string">&quot;sk:&quot;</span> + prodid + <span class="string">&quot;:user&quot;</span>;</span><br><span class="line">  </span><br><span class="line">	<span class="comment">//监视库存</span></span><br><span class="line">	jedis.watch(kcKey);</span><br><span class="line">  </span><br><span class="line">	String kc = jedis.get(kcKey);</span><br><span class="line">	<span class="keyword">if</span> (kc == <span class="keyword">null</span>)&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;秒杀还未开始，请等待！&quot;</span>);</span><br><span class="line">		jedis.close();</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">	<span class="comment">//判断是否重复秒杀</span></span><br><span class="line">	<span class="keyword">if</span> (jedis.sismember(userKey, uid))&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;已经参加过秒杀，不能重复秒杀&quot;</span>);</span><br><span class="line">		jedis.close();</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">	<span class="comment">//判断库存</span></span><br><span class="line">	<span class="keyword">if</span> (Integer.parseInt(kc) &lt; <span class="number">1</span>)&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;秒杀结束&quot;</span>);</span><br><span class="line">		jedis.close();</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">	<span class="comment">//秒杀过程,添加事务</span></span><br><span class="line">	Transaction multi = jedis.multi();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//组队</span></span><br><span class="line">	multi.decr(kcKey);</span><br><span class="line">	multi.sadd(userKey, uid);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//执行</span></span><br><span class="line">	List&lt;Object&gt; exec = multi.exec();</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">	<span class="keyword">if</span> (exec == <span class="keyword">null</span> || exec.isEmpty())&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;秒杀失败&quot;</span>);</span><br><span class="line">		jedis.close();</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">	System.out.println(<span class="string">&quot;秒杀成功!&quot;</span>);</span><br><span class="line">	jedis.close();</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>库存遗留问题</strong>：乐观锁导致很多请求失败，先秒杀的反而不如后秒杀的。</p>
<blockquote>
<p> LUA脚本解决：</p>
<ul>
<li>将复杂的或者多步的redis操作，写为一个脚本，一次提交给redis执行，减少反复连接redis的次数。提升性能</li>
<li>LUA脚本是类似redis事务，有一定的原子性，不会被其他命令插队，可以完成一些redis事务性的操作</li>
<li>实际上是redis 利用其单线程的特性，用任务队列的方式解决多任务并发问题</li>
</ul>
</blockquote>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> userid=KEYS[<span class="number">1</span>]; </span><br><span class="line"><span class="keyword">local</span> prodid=KEYS[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">local</span> qtkey=<span class="string">&quot;sk:&quot;</span>..prodid..<span class="string">&quot;:qt&quot;</span>;</span><br><span class="line"><span class="keyword">local</span> usersKey=<span class="string">&quot;sk:&quot;</span>..prodid.<span class="string">&quot;:usr&#x27;; </span></span><br><span class="line"><span class="string">local userExists=redis.call(&quot;</span>sismember<span class="string">&quot;,usersKey,userid);</span></span><br><span class="line"><span class="string">if tonumber(userExists)==1 then </span></span><br><span class="line"><span class="string">  //已经秒杀过了</span></span><br><span class="line"><span class="string">  return 2;</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"><span class="string">local num= redis.call(&quot;</span>get<span class="string">&quot; ,qtkey);</span></span><br><span class="line"><span class="string">if tonumber(num)&lt;=0 then </span></span><br><span class="line"><span class="string">  //库存不够</span></span><br><span class="line"><span class="string">  return 0; </span></span><br><span class="line"><span class="string">else </span></span><br><span class="line"><span class="string">  redis.call(&quot;</span>decr<span class="string">&quot;,qtkey);</span></span><br><span class="line"><span class="string">  redis.call(&quot;</span>sadd<span class="string">&quot;,usersKey,userid);</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"><span class="string">//秒杀成功</span></span><br><span class="line"><span class="string">return 1;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">doSecKill</span><span class="params">(String uid,String prodid)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  </span><br><span class="line">	<span class="comment">//uid和 prodid 非空判断</span></span><br><span class="line">	<span class="keyword">if</span> (uid==<span class="keyword">null</span> || prodid==<span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  </span><br><span class="line">	JedisPool jedispool =  JedisPoolUtil.getJedisPoolInstance();</span><br><span class="line">	Jedis jedis=jedispool.getResource();</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">	 <span class="comment">//加载lua脚本</span></span><br><span class="line">	String sha1=  jedis.scriptLoad(secKillScript);</span><br><span class="line">	Object result= jedis.evalsha(sha1, <span class="number">2</span>, uid,prodid);</span><br><span class="line">  </span><br><span class="line">	String reString=String.valueOf(result);</span><br><span class="line">	<span class="keyword">if</span> (<span class="string">&quot;0&quot;</span>.equals( reString )  ) &#123;</span><br><span class="line">		System.err.println(<span class="string">&quot;已抢空！！&quot;</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;1&quot;</span>.equals( reString )  )  &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;抢购成功！！！！&quot;</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;2&quot;</span>.equals( reString )  )  &#123;</span><br><span class="line">		System.err.println(<span class="string">&quot;该用户已抢过！！&quot;</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		System.err.println(<span class="string">&quot;抢购异常！！&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	jedis.close();</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h1><ul>
<li>持久化：将Redis数据写入到硬盘</li>
</ul>
<h2 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h2><ul>
<li><p><strong>RDB（Redis DataBase）</strong>：在指定的<strong>时间间隔</strong>内，将内存中的<strong>数据集快照</strong>写入到磁盘中。恢复时将快照文件直接读到内存里</p>
</li>
<li><p><strong>备份的执行过程</strong>：Redis会单独创建（<strong>fork</strong>）一个子进程来进行持久化，会先将数据写入到 一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。 整个过程中，<strong>主进程是不进行任何IO操作的，这就确保了极高的性能</strong></p>
<ul>
<li><p>如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加的高效</p>
</li>
<li><p>RDB的缺点是最后一次持久化后的数据可能丢失；需要额外空间</p>
<p><img src="/2021/12/19/day28/day28_17.png" alt="RDB过程"></p>
</li>
</ul>
</li>
<li><p><strong>Fork</strong>：复制一个与当前进程一样的进程。新进程的所有数据原进程一致，但是是一个全新的进程，并作为原进程的子进程，使用了<strong>写时复制技术</strong></p>
</li>
</ul>
<h2 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h2><ul>
<li><p><strong>AOF（Append Only File）</strong>:以日志的形式记录<strong>写操作</strong>（不记录读操作），将Redis执行过的所有指令记录下来，<strong>只允许追加文件不允许修改文件</strong>。redis启动之初会读取该文件重新构建数据</p>
</li>
<li><p>AOF执行流程：</p>
<ul>
<li><p>客户端的请求写命令会被append追加到AOF缓冲区内</p>
</li>
<li><p>AOF缓冲区根据AOF持久化策略**[always,everysec,no]**将操作sync同步到磁盘的AOF文件中</p>
<ul>
<li>always：每次写入都记入日志</li>
<li>everysec：每秒记录一次</li>
<li>no：redis不主动同步，将同步时机交给操作系统</li>
</ul>
</li>
<li><p>AOF文件大小超过重写策略或手动重写时，会对AOF文件<strong>rewrite</strong>重写，压缩AOF文件容量</p>
<ul>
<li>Rewrite：只关注结果，不关注过程，将多个操作进行合并</li>
<li>AOF文件持续增长而过大时，会<strong>fork</strong>出一条新进程来将文件重写(也是先写临时文件最后再rename)，<strong>redis4.0版本后的重写</strong>，是指上就是把<strong>rdb 的快照，以二级制的形式附在新的aof头部，作为已有的历史数据，</strong>替换掉原来的流水账操作</li>
<li>Redis会记录上次重写时的AOF大小，默认配置是当AOF文件大小是上次rewrite后大小的一倍且文件大于64M时触发</li>
</ul>
<p><img src="/2021/12/19/day28/day28_19.png" alt="重写流程"></p>
</li>
<li><p>Redis服务重启时，会重新load加载AOF文件中的写操作达到数据恢复的目的</p>
</li>
</ul>
<p><img src="/2021/12/19/day28/day28_18.png" alt="AOF"></p>
</li>
<li><p>AOF默认不开启：配置文件修改<strong>appendonly yes</strong></p>
</li>
<li><p>AOF和RDB同时开启，会使用AOF，因为不会产生数据丢失</p>
</li>
<li><p><strong>异常恢复</strong>：如遇到<strong>AOF文件损坏</strong>，通过**/usr/local/bin/redis-check-aof–fix appendonly.aof**进行恢复</p>
</li>
<li><p>优势：备份机制更稳健，丢失数据概率更低；可读的日志文本，通过操作AOF稳健，可以处理误操作</p>
</li>
<li><p>劣势：占用更多空间；恢复速度慢；每次都同步会有性能压力</p>
</li>
</ul>
<h1 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h1><ul>
<li><p>主从复制：主机数据更新后，根据配置和策略自动同步到备机的<strong>mater/slaver</strong>机制，Master以写为主，Slave以读为主，一主多从</p>
<ul>
<li>读写分离，性能扩展</li>
<li>容灾快速恢复：从服务器挂掉，可以快速切换到其他从服务器</li>
</ul>
<p><img src="/2021/12/19/day28/day28_20.png" alt="主从复制"></p>
</li>
</ul>
<h2 id="模拟主从复制"><a href="#模拟主从复制" class="headerlink" title="模拟主从复制"></a>模拟主从复制</h2><ul>
<li><p>创建配置文件，定义不同端口号，6379，6380，6381</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">include /myredis/redis.conf</span><br><span class="line">pidfile /var/run/redis<span class="built_in">_</span>6379.pid</span><br><span class="line">port 6379</span><br><span class="line">masterauth wan.1314</span><br><span class="line">dbfilename dump6379.rdb</span><br></pre></td></tr></table></figure></li>
<li><p><code>redis-server redis6380.conf</code>启动redis，<code>info replication</code>可以查看主机运行情况</p>
<p><img src="/2021/12/19/day28/day28_21.png" alt="运行状态"></p>
</li>
<li><p>配置主从：<code>slaveof  &lt;ip&gt;&lt;port&gt;</code>，从机上执行</p>
<p><img src="/2021/12/19/day28/day28_22.png" alt="一主两从"></p>
</li>
</ul>
<h2 id="常见问题及复制原理"><a href="#常见问题及复制原理" class="headerlink" title="常见问题及复制原理"></a>常见问题及复制原理</h2><ul>
<li>从服务器挂掉之后重启，会重新变成主服务器。再次变成从服务器后，会将主服务器中的数据从头开始复制</li>
<li>主服务器挂掉之后，从服务器不会改变。主服务器重启之后，还是主服务器</li>
<li>上一个slave可以是下一个slave的master，中途变更转向会清除之前的数据，重新拷贝新的数据</li>
<li>当一个master宕机后，后面的slave可以升级为master。<code>slaveof no one</code></li>
</ul>
<blockquote>
<p>复制原理：</p>
<ul>
<li>Slave启动成功连接到master后会发送一个sync命令</li>
<li>Master接到命令启动后台的存盘进程，进行持久化，获得rdb文件。master将传送rdb文件到slave，以完成一次完全同步</li>
<li>每次主服务器进行写操作后，和从服务器进行数据同步</li>
<li><strong>全量复制</strong>：而slave服务在接收到数据库文件数据后，将其存盘并加载到内存中</li>
<li><strong>增量复制</strong>：Master继续将新的所有收集到的修改命令依次传给slave,完成同步</li>
</ul>
</blockquote>
<h2 id="哨兵模式"><a href="#哨兵模式" class="headerlink" title="哨兵模式"></a>哨兵模式</h2><ul>
<li><p>后台监视主机是否故障，出现故障后根据投票数自动将从库转为主库</p>
</li>
<li><p>配置步骤：</p>
<ul>
<li><p>创建sentinel.conf文件</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%其中mymaster为监控对象起的服务器名称， 1 为至少有多少个哨兵同意迁移的数量</span></span><br><span class="line">sentinel monitor mymaster 127.0.0.1 6379 1</span><br></pre></td></tr></table></figure></li>
<li><p>启动哨兵：<code>redis-sentinel sentinel.conf</code></p>
</li>
</ul>
</li>
<li><p>主库宕机后，某一个从库变为主库，原主库恢复后，会变成从库</p>
</li>
<li><p>复制延时：由于只有主机才能进行写操作，将数据同步到slave上时，会有延时，当slave数量变多时，延时问题会更严重</p>
</li>
<li><p>选择条件：</p>
<ul>
<li>优先级：在配置文件中设置，值越小优先级越高</li>
<li>偏移量：获得原主机数据最全的</li>
<li>runid：每个redis启动后都会随机生成一个40位的runid</li>
</ul>
<p><img src="/2021/12/19/day28/day28_23.png" alt="哨兵模式"></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//jedis哨兵操作</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> JedisSentinelPool jedisSentinelPool=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  Jedis <span class="title">getJedisFromSentinel</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(jedisSentinelPool==<span class="keyword">null</span>)&#123;</span><br><span class="line">        Set&lt;String&gt; sentinelSet=<span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        sentinelSet.add(<span class="string">&quot;192.168.11.103:26379&quot;</span>);</span><br><span class="line"></span><br><span class="line">        JedisPoolConfig jedisPoolConfig =<span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">        jedisPoolConfig.setMaxTotal(<span class="number">10</span>); <span class="comment">//最大可用连接数</span></span><br><span class="line">        jedisPoolConfig.setMaxIdle(<span class="number">5</span>); <span class="comment">//最大闲置连接数</span></span><br><span class="line">        jedisPoolConfig.setMinIdle(<span class="number">5</span>); <span class="comment">//最小闲置连接数</span></span><br><span class="line">        jedisPoolConfig.setBlockWhenExhausted(<span class="keyword">true</span>); <span class="comment">//连接耗尽是否等待</span></span><br><span class="line">        jedisPoolConfig.setMaxWaitMillis(<span class="number">2000</span>); <span class="comment">//等待时间</span></span><br><span class="line">        jedisPoolConfig.setTestOnBorrow(<span class="keyword">true</span>); <span class="comment">//取连接的时候进行一下测试 ping pong</span></span><br><span class="line"></span><br><span class="line">        jedisSentinelPool=<span class="keyword">new</span> JedisSentinelPool(<span class="string">&quot;mymaster&quot;</span>,sentinelSet,jedisPoolConfig);</span><br><span class="line">        <span class="keyword">return</span> jedisSentinelPool.getResource();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> jedisSentinelPool.getResource();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h1><ul>
<li><p>集群：对redis进行水平扩容，启动N个redis节点，将整个数据库分布存储在N个节点中</p>
<ul>
<li>可以扩充容量；高并发</li>
</ul>
</li>
<li><p>无中心化集群</p>
</li>
<li><p>配置文件</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">include redis.conf</span><br><span class="line">port 6382</span><br><span class="line">pidfile &quot;/var/run/redis<span class="built_in">_</span>6382.pid&quot;</span><br><span class="line">dbfilename &quot;dump6382.rdb&quot;</span><br><span class="line">masterauth wan.1314</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes-6382.conf</span><br><span class="line">cluster-node-timeout 15000</span><br></pre></td></tr></table></figure></li>
<li><p>启动所有redis</p>
</li>
<li><p>集群操作：<code>redis-cli --cluster create --cluster-replicas 1 192.168.11.101:6379 192.168.11.101:6380 192.168.11.101:6381 192.168.11.101:6389 192.168.11.101:6390 192.168.11.101:6391</code></p>
</li>
<li><p>分配原则：尽量保证每个主数据库运行在不同的IP地址，每个从库和主库不在一个IP地址</p>
</li>
<li><p>集群使用公式 <strong>CRC16(key) % 16384</strong> 来计算键 key 属于哪个槽， 其中 CRC16(key) 语句用于计算键 key 的 CRC16 校验和 </p>
<ul>
<li>不在同一个slot下的键值，不能使用mget,mset</li>
<li>可以通过{}来定义组的概念，使得key中{}相同内容的键值对放在同一个slot</li>
</ul>
</li>
<li><p>故障恢复：</p>
<ul>
<li>主节点下线，从节点自动升为主节点</li>
<li>主节点恢复后，变为从机</li>
<li>主机和从机都挂掉，如果<code>cluster-require-full-coverage</code>为yes，整个集群都挂掉；如果为no，只是该slot范围挂掉</li>
</ul>
</li>
</ul>
<h2 id="jedis集群"><a href="#jedis集群" class="headerlink" title="jedis集群"></a>jedis集群</h2><ul>
<li>即使连接的不是主机，也会自动切换主机存储，主机写，从机读</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisClusterTest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123; </span><br><span class="line">     Set&lt;HostAndPort&gt;set =<span class="keyword">new</span> HashSet&lt;HostAndPort&gt;();</span><br><span class="line">     set.add(<span class="keyword">new</span> HostAndPort(<span class="string">&quot;192.168.31.211&quot;</span>,<span class="number">6379</span>));</span><br><span class="line">     JedisCluster jedisCluster=<span class="keyword">new</span> JedisCluster(set);</span><br><span class="line">     jedisCluster.set(<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;v1&quot;</span>);</span><br><span class="line">     System.out.println(jedisCluster.get(<span class="string">&quot;k1&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>集群优缺点：<ul>
<li>优点：实现扩容；分摊压力；无中心化配置简单</li>
<li>缺点：多建操作不被支持；多键的事务不被支持；lua脚本不被支持</li>
</ul>
</li>
</ul>
<h1 id="具体场景问题"><a href="#具体场景问题" class="headerlink" title="具体场景问题"></a>具体场景问题</h1><h2 id="缓存穿透"><a href="#缓存穿透" class="headerlink" title="缓存穿透"></a>缓存穿透</h2><ul>
<li>缓存穿透：key对应的数据在数据源中不存在，每次针对key的请求在缓存中无法获得，黑客可以利用这个漏洞，让服务器崩溃</li>
<li><strong>出现的原因</strong>：服务器压力变大；redis命中率低；一直查询数据库，导致崩溃<ul>
<li>redis查询不到数据库</li>
<li>出现很多非正常URL访问</li>
</ul>
</li>
<li>解决方案：<ul>
<li><strong>对空值缓存</strong>：即使访问的数据在数据库中不存在，也进行缓存，但是过期时间比较短</li>
<li><strong>设置可访问的名单（白名单）</strong>：使用bitmaps定义一个可访问的名单，名单id作为bitmaps的偏移量，如果访问的id不在bitmaps中，不允许访问</li>
<li><strong>采用布隆过滤器</strong>：将所有可能存在的数据哈希到一个足够大的bitmaps中，一个一定不存在的数据会被 这个bitmaps拦截掉，从而避免了对底层存储系统的查询压力</li>
<li><strong>进行实时监控</strong>：发现redis命中率降低时，排查访问对象和访问数据，设置黑名单</li>
</ul>
</li>
</ul>
<h2 id="缓存击穿"><a href="#缓存击穿" class="headerlink" title="缓存击穿"></a>缓存击穿</h2><ul>
<li><p>缓存击穿：某个key过期，突然有大量并发请求获得该key，都一起查询数据库</p>
</li>
<li><p>出现原因：数据库访问压力瞬时增加；redis里面没有出现大量key过期；redis正常运行</p>
<ul>
<li>某个热门访问的key过期</li>
</ul>
</li>
<li><p>解决方法：</p>
<ul>
<li><p><strong>预先设置热门数据</strong>：将一些热门数据提前存入到redis，并加大时长</p>
</li>
<li><p><strong>实时调整</strong>：监控哪些key比较热门，实时调整时长</p>
</li>
<li><p><strong>使用锁</strong>：</p>
<p><img src="/2021/12/19/day28/day28_24.png" alt="使用锁解决缓存击穿"></p>
</li>
</ul>
</li>
</ul>
<h2 id="缓存雪崩"><a href="#缓存雪崩" class="headerlink" title="缓存雪崩"></a>缓存雪崩</h2><ul>
<li>缓存雪崩：极少时间段内，查询的大量key过期，导致数据库压力变大</li>
<li>解决方案：<ul>
<li><strong>构建多级缓存架构</strong>：nginx缓存 + redis缓存 + 其他缓存等</li>
<li><strong>使用锁或队列</strong>：用加锁或者队列的方式保证来保证不会有大量的线程对数据库一次性进行读写，从而避免失效时大量的并发请求落到底层存储系统上。不适用高并发情况</li>
<li><strong>设置过期标志更新缓存</strong>：记录缓存数据是否过期，如果过期通知另一个线程更新实际key的缓存</li>
<li><strong>将缓存失效时间分散开</strong>：可以在原有的失效时间基础上增加一个随机值，防止大量key在短时间内失效</li>
</ul>
</li>
</ul>
<h1 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h1><ul>
<li>实现方案：<ul>
<li>基于数据库实现</li>
<li>基于缓存实现</li>
<li>基于Zookeeper</li>
</ul>
</li>
</ul>
<h2 id="使用Redis实现分布式锁"><a href="#使用Redis实现分布式锁" class="headerlink" title="使用Redis实现分布式锁"></a>使用Redis实现分布式锁</h2><ul>
<li><p>redis命令：<code>setnx key second value</code></p>
<p><img src="/2021/12/19/day28/day28_25.png" alt="分布式锁"></p>
</li>
<li><p>设置锁过期时间：<code>set key value ex 3000 nx</code></p>
</li>
<li><p>可能业务没有执行完，锁已经被释放：<strong>相当于没有上锁</strong></p>
<p><img src="/2021/12/19/day28/day28_26.png" alt="释放别人的锁"></p>
<ul>
<li>使用UUID防止误删：<ul>
<li>为每个操作都生成一个唯一的UUID作为value</li>
<li>释放锁时，判断value值和自己的uuid是否相同，相同才能释放</li>
</ul>
</li>
</ul>
</li>
<li><p>删除操作缺乏原子性：会发生误删</p>
<p><img src="/2021/12/19/day28/day28_27.png" alt="删除操作"></p>
<ul>
<li>lua脚本实现释放锁的原子性</li>
</ul>
</li>
<li><p>确保分布式锁可用：</p>
<ul>
<li>互斥性</li>
<li>不会发生死锁：设置过期时间</li>
<li>加锁和解锁必须是同一个客户端</li>
<li>加锁和解锁必须具有原子性</li>
</ul>
</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/11/10/day27/" rel="prev" title="操作系统">
      <i class="fa fa-chevron-left"></i> 操作系统
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/01/03/day29/" rel="next" title="八股">
      八股 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#NoSQL"><span class="nav-number">1.</span> <span class="nav-text">NoSQL</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis%E6%A6%82%E8%BF%B0"><span class="nav-number">2.</span> <span class="nav-text">Redis概述</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-number">3.</span> <span class="nav-text">常用数据结构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Key%E6%93%8D%E4%BD%9C"><span class="nav-number">3.1.</span> <span class="nav-text">Key操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#String"><span class="nav-number">3.2.</span> <span class="nav-text">String</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#String-%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-number">3.2.1.</span> <span class="nav-text">String 的数据结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#List"><span class="nav-number">3.3.</span> <span class="nav-text">List</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#List%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-number">3.3.1.</span> <span class="nav-text">List数据结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Set"><span class="nav-number">3.4.</span> <span class="nav-text">Set</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#set%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-number">3.4.1.</span> <span class="nav-text">set的数据结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hash"><span class="nav-number">3.5.</span> <span class="nav-text">Hash</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Hash%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-number">3.5.1.</span> <span class="nav-text">Hash数据结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Zset-sorted-set"><span class="nav-number">3.6.</span> <span class="nav-text">Zset(sorted set)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Zset%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-number">3.6.1.</span> <span class="nav-text">Zset数据结构</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%91%E5%B8%83%E4%B8%8E%E8%AE%A2%E9%98%85"><span class="nav-number">4.</span> <span class="nav-text">发布与订阅</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%96%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">5.</span> <span class="nav-text">新的数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Bitmaps"><span class="nav-number">5.1.</span> <span class="nav-text">Bitmaps</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HyperLogLog"><span class="nav-number">5.2.</span> <span class="nav-text">HyperLogLog</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Geospatial"><span class="nav-number">5.3.</span> <span class="nav-text">Geospatial</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Jedis"><span class="nav-number">6.</span> <span class="nav-text">Jedis</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E6%8B%9F%E9%AA%8C%E8%AF%81%E7%A0%81%E5%8F%91%E9%80%81"><span class="nav-number">6.1.</span> <span class="nav-text">模拟验证码发送</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SpringBoot%E6%95%B4%E5%90%88Redis"><span class="nav-number">7.</span> <span class="nav-text">SpringBoot整合Redis</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1"><span class="nav-number">8.</span> <span class="nav-text">事务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%82%B2%E8%A7%82%E9%94%81%E5%92%8C%E4%B9%90%E8%A7%82%E9%94%81"><span class="nav-number">8.1.</span> <span class="nav-text">悲观锁和乐观锁</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis%E4%BA%8B%E5%8A%A1%E4%B8%89%E5%A4%A7%E7%89%B9%E6%80%A7"><span class="nav-number">8.2.</span> <span class="nav-text">Redis事务三大特性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E7%A7%92%E6%9D%80%E6%A1%88%E4%BE%8B"><span class="nav-number">8.3.</span> <span class="nav-text">简单秒杀案例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96"><span class="nav-number">9.</span> <span class="nav-text">持久化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#RDB"><span class="nav-number">9.1.</span> <span class="nav-text">RDB</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AOF"><span class="nav-number">9.2.</span> <span class="nav-text">AOF</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="nav-number">10.</span> <span class="nav-text">主从复制</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E6%8B%9F%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="nav-number">10.1.</span> <span class="nav-text">模拟主从复制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%8F%8A%E5%A4%8D%E5%88%B6%E5%8E%9F%E7%90%86"><span class="nav-number">10.2.</span> <span class="nav-text">常见问题及复制原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F"><span class="nav-number">10.3.</span> <span class="nav-text">哨兵模式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4"><span class="nav-number">11.</span> <span class="nav-text">集群</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#jedis%E9%9B%86%E7%BE%A4"><span class="nav-number">11.1.</span> <span class="nav-text">jedis集群</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E5%9C%BA%E6%99%AF%E9%97%AE%E9%A2%98"><span class="nav-number">12.</span> <span class="nav-text">具体场景问题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F"><span class="nav-number">12.1.</span> <span class="nav-text">缓存穿透</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF"><span class="nav-number">12.2.</span> <span class="nav-text">缓存击穿</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9"><span class="nav-number">12.3.</span> <span class="nav-text">缓存雪崩</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="nav-number">13.</span> <span class="nav-text">分布式锁</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Redis%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="nav-number">13.1.</span> <span class="nav-text">使用Redis实现分布式锁</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Kaixuan Wang"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Kaixuan Wang</p>
  <div class="site-description" itemprop="description">只争朝夕</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">33</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kaixuan Wang</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
